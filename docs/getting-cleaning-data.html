<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="JJC">

<title>Excess Mortality in Scotland - Getting and Cleaning Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./data-sources.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./getting-cleaning-data.html">Getting and Cleaning Data</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./images/covid19_variant.jpeg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://openscapes.org" rel="" title="Openscapes.org" class="quarto-navigation-tool px-1" aria-label="Openscapes.org"><i class="bi bi-globe"></i></a>
    <a href="https://github.com/jjcoen/vax-scotland" rel="" title="Data and Analysis" class="quarto-navigation-tool px-1" aria-label="Data and Analysis"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting-cleaning-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Getting and Cleaning Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-sources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Sources</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#population" id="toc-population" class="nav-link active" data-scroll-target="#population">Population</a></li>
  <li><a href="#mortality" id="toc-mortality" class="nav-link" data-scroll-target="#mortality">Mortality</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jjcoen/vax-scotland/edit/main/getting-cleaning-data.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jjcoen/vax-scotland/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Getting and Cleaning Data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>JJC </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="population" class="level2">
<h2 class="anchored" data-anchor-id="population">Population</h2>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section">2019</h3>
<p>In the source data, year of age and population numbers are stored in multiple columns:</p>
<p><img src="images/NRS-2019-pop-by-age.png" class="img-fluid"></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"./code/get-pop.R"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/mid-year-pop-est-19-data.xlsx"</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>scot_pop19 <span class="ot">&lt;-</span> <span class="fu">get_pop_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 total:  5463300 
 sum of pop categories:  5463300</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>age_categories <span class="ot">&lt;-</span> scot_pop19[, age_cat]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-1" class="level3">
<h3 class="anchored" data-anchor-id="section-1">2022</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 3 contains Population by age category</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>scot_pop22 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"./data/scotland-s-census-2022-first-results-rounded-population-estimates-data.xlsx"</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sheet =</span> <span class="st">"Table 3"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">n_max =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setDT</span>()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># First 3 columns are superfluous</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>scot_pop22[, <span class="fu">c</span>(<span class="st">"Area name"</span>, <span class="st">"Area code"</span>, <span class="st">"Area type"</span> ) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># remove "All ages" column and calculate totals after processing</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>scot_pop22[, <span class="st">"All ages"</span> <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>scot_pop22 <span class="sc">|&gt;</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Sex</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 0-4 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 5-9 year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 10-14 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 15-19 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 20-24 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 25-29 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 30-34 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 35-39 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 40-44 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 45-49 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 50-54 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 55-59 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 60-64 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 65-69 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 70-74 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 75-79 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 80-84 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 85-89 years</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Aged 90+ years</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Persons</td>
<td style="text-align: right;">247100</td>
<td style="text-align: right;">284100</td>
<td style="text-align: right;">301000</td>
<td style="text-align: right;">299100</td>
<td style="text-align: right;">337000</td>
<td style="text-align: right;">338200</td>
<td style="text-align: right;">356000</td>
<td style="text-align: right;">347000</td>
<td style="text-align: right;">334300</td>
<td style="text-align: right;">329500</td>
<td style="text-align: right;">391500</td>
<td style="text-align: right;">408600</td>
<td style="text-align: right;">372100</td>
<td style="text-align: right;">315300</td>
<td style="text-align: right;">284800</td>
<td style="text-align: right;">218300</td>
<td style="text-align: right;">142300</td>
<td style="text-align: right;">85400</td>
<td style="text-align: right;">45000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Females</td>
<td style="text-align: right;">120100</td>
<td style="text-align: right;">138300</td>
<td style="text-align: right;">147200</td>
<td style="text-align: right;">146000</td>
<td style="text-align: right;">170500</td>
<td style="text-align: right;">172300</td>
<td style="text-align: right;">182600</td>
<td style="text-align: right;">178200</td>
<td style="text-align: right;">171200</td>
<td style="text-align: right;">169000</td>
<td style="text-align: right;">202400</td>
<td style="text-align: right;">210400</td>
<td style="text-align: right;">191200</td>
<td style="text-align: right;">163300</td>
<td style="text-align: right;">149300</td>
<td style="text-align: right;">118500</td>
<td style="text-align: right;">81900</td>
<td style="text-align: right;">52400</td>
<td style="text-align: right;">29800</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Males</td>
<td style="text-align: right;">127000</td>
<td style="text-align: right;">145800</td>
<td style="text-align: right;">153900</td>
<td style="text-align: right;">153000</td>
<td style="text-align: right;">166400</td>
<td style="text-align: right;">166000</td>
<td style="text-align: right;">173400</td>
<td style="text-align: right;">168800</td>
<td style="text-align: right;">163100</td>
<td style="text-align: right;">160500</td>
<td style="text-align: right;">189100</td>
<td style="text-align: right;">198200</td>
<td style="text-align: right;">180900</td>
<td style="text-align: right;">152000</td>
<td style="text-align: right;">135400</td>
<td style="text-align: right;">99800</td>
<td style="text-align: right;">60300</td>
<td style="text-align: right;">33100</td>
<td style="text-align: right;">15200</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>This data has three variables:</p>
<ul>
<li><code>Sex</code>, stored in the rows,</li>
<li><code>age_category</code> spread across the column names, and</li>
<li>population numbers are stored in the cell values.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>scot_pop22 <span class="ot">&lt;-</span> scot_pop22 <span class="sc">%&gt;%</span>    </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(     </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="sc">!</span>Sex, <span class="co"># reshape every column apart from "Sex" </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"age"</span>,      </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"pop"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_transform =</span> readr<span class="sc">::</span>parse_number) <span class="sc">|&gt;</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setDT</span>()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( scot_pop22 )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       sex age    pop
1: Persons   0 247100
2: Persons   5 284100
3: Persons  10 301000
4: Persons  15 299100
5: Persons  20 337000
6: Persons  25 338200</code></pre>
</div>
</div>
<ul>
<li>There are 19 age categories in 5 year intervals.</li>
<li>The last entry is for 90 years and older.</li>
<li><code>sex</code> has three categories: <em>Persons, Males, Females.</em></li>
</ul>
<p>Separate the combined counts, which is given by the “Person” entries in the <code>sex</code> variable</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># store Male and Female values for later analysis </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># scot_pop22_MF &lt;- scot_pop22[sex %in% c("Males","Females") ,]</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># All Persons</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>scot_pop22 <span class="ot">&lt;-</span> scot_pop22[sex <span class="sc">==</span> <span class="st">"Persons"</span> ,]  </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># no longer need the "sex" variable</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>scot_pop22[, sex <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># add 'age_cat' column for compatibility with other years</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>scot_pop22[, age_cat <span class="sc">:</span><span class="er">=</span> age_categories][, age <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">setcolorder</span>(scot_pop22, <span class="fu">c</span>(<span class="st">"age_cat"</span>, <span class="st">"pop"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot population counts by age category</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># suppress scientific notation</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">20</span>)  </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(scot_pop22, <span class="fu">aes</span>(age_cat, pop)) <span class="sc">+</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> pop)) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Scotland Population 2022"</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"by 5-year age category"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Age 5yr"</span>, <span class="at">y =</span> <span class="st">"Population"</span>) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="getting-cleaning-data_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-2" class="level3">
<h3 class="anchored" data-anchor-id="section-2">2021</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1 contains Population by each year of </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>scot_pop21 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"./data/mid-year-pop-est-21-data.xlsx"</span>, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sheet =</span> <span class="st">"Table 1"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">skip =</span> <span class="dv">3</span>, <span class="at">n_max =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#    clean_names() |&gt; </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setDT</span>()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># First 3 columns are superfluous</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>scot_pop21[, <span class="fu">c</span>(<span class="st">"Area name"</span>, <span class="st">"Area code"</span>, <span class="st">"Area type"</span> ) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># remove "All ages" column and calculate totals after processing</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>scot_pop21[, <span class="st">"All ages"</span> <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Inspect the Data</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>scot_pop21[, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       Sex     0     1     2     3     4     5     6     7     8
1: Persons 46782 49017 51478 53317 54843 57070 57945 58262 59490
2:   Males 23961 25131 26485 27398 28339 29530 29710 29948 30459
3: Females 22821 23886 24993 25919 26504 27540 28235 28314 29031</code></pre>
</div>
</div>
<p>Check the final column</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>scot_pop21[, <span class="dv">92</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     90+
1: 45321
2: 14421
3: 30900</code></pre>
</div>
</div>
<p>This data has three variables:</p>
<ul>
<li><code>Sex</code>, stored in the rows,</li>
<li><code>age</code> spread across the column names, and</li>
<li>population numbers are stored in the cell values.</li>
</ul>
<p><code>pivot_longer:</code></p>
<ul>
<li><code>names_to</code> gives the name of the variable that will be created from the data stored in the column names, i.e.&nbsp;year of age</li>
<li><code>values_to</code> gives the name of the variable that will be created from the data stored in the cell value, i.e.&nbsp;population count</li>
</ul>
<p>Entries in the <code>age</code> column are in character format. <a href="https://readr.tidyverse.org/reference/parse_number.html"><code>readr::parse_number()</code></a> extracts numeric values and automatically strips non-numeric components, so it can deal with the “90+” entry</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>scot_pop21 <span class="ot">&lt;-</span> scot_pop21 <span class="sc">%&gt;%</span>    </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(     </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="sc">!</span>Sex, <span class="co"># reshape every column apart from "Sex" </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"age"</span>,      </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"pop"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_transform =</span> readr<span class="sc">::</span>parse_number) <span class="sc">|&gt;</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setDT</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Separate the combined counts, which is given by the “Person” entries in the <code>sex</code> variable</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># store Male and Female values for later analysis</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># scot_pop21_MF &lt;- scot_pop21[sex %in% c("Males","Females") ,]</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># counts for male + female</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>scot_pop21 <span class="ot">&lt;-</span> scot_pop21[sex <span class="sc">==</span> <span class="st">"Persons"</span> ,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Need to combine rows of <code>age</code> to 5-year age categories and to sum the associated population numbers. Bear in mind that the “90” entry refers to ages 90 and above. This means that there will be 18 age categories with an additional one for over 90.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># "sex" column is no longer needed</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>scot_pop21[, sex <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>over90 <span class="ot">&lt;-</span> scot_pop21[<span class="dv">91</span>, pop]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>scot_pop21 <span class="ot">&lt;-</span> scot_pop21[<span class="sc">-</span><span class="dv">91</span>,]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a grouping variable</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>scot_pop21[, age_cat <span class="sc">:</span><span class="er">=</span> <span class="fu">cut2</span>(age, <span class="at">g =</span> <span class="dv">18</span>)]</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sum the number of deaths in each age category</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>scot_pop21_cats <span class="ot">&lt;-</span> scot_pop21[, <span class="fu">sum</span>(pop), by <span class="ot">=</span> age_cat]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>scot_pop21_cats[, pop <span class="sc">:</span><span class="er">=</span> V1][, V1 <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># append an entry for the 90 plus group</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>oldest <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">age_cat =</span> <span class="fu">as.factor</span>(<span class="st">"90 plus"</span>), </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pop =</span> over90)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>scot_pop21 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(scot_pop21_cats, oldest)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># update "age_cat" column for compatibility with other years</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>scot_pop21[, age_cat <span class="sc">:</span><span class="er">=</span> age_categories]</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(scot_pop21_cats, oldest, over90)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-3" class="level3">
<h3 class="anchored" data-anchor-id="section-3">2018</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/mid-year-pop-est-18-tabs.xlsx"</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>scot_pop18 <span class="ot">&lt;-</span> <span class="fu">get_pop_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 total:  5438100 
 sum of pop categories:  5438100</code></pre>
</div>
</div>
</section>
<section id="section-4" class="level3">
<h3 class="anchored" data-anchor-id="section-4">2017</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/mid-year-pop-est-17-all-tables-revised.xlsx"</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>scot_pop17 <span class="ot">&lt;-</span> <span class="fu">get_pop_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 total:  5424800 
 sum of pop categories:  5424800</code></pre>
</div>
</div>
</section>
<section id="section-5" class="level3">
<h3 class="anchored" data-anchor-id="section-5">2016</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"./code/get-pop-16.R"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/16-mid-year-pe-tab1.xlsx"</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>scot_pop16 <span class="ot">&lt;-</span> <span class="fu">get_pop_2016</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 total:  5404700 
  sum of pop categories:  5404700</code></pre>
</div>
</div>
</section>
<section id="section-6" class="level3">
<h3 class="anchored" data-anchor-id="section-6">2015</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/15mype-cahb-tab1.xlsx"</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>scot_pop15 <span class="ot">&lt;-</span> <span class="fu">get_pop_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 total:  5373000 
 sum of pop categories:  5373000</code></pre>
</div>
</div>
</section>
<section id="section-7" class="level3">
<h3 class="anchored" data-anchor-id="section-7">2014</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/14mype-cahb-all-tab.xlsx"</span>  </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>scot_pop14 <span class="ot">&lt;-</span> <span class="fu">get_pop_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 total:  5347600 
 sum of pop categories:  5347600</code></pre>
</div>
</div>
</section>
<section id="section-8" class="level3">
<h3 class="anchored" data-anchor-id="section-8">2013</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/13mype-cahb-tab1.xlsx"</span>  </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>scot_pop13 <span class="ot">&lt;-</span> <span class="fu">get_pop_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 total:  5327700 
 sum of pop categories:  5327700</code></pre>
</div>
</div>
</section>
<section id="section-9" class="level3">
<h3 class="anchored" data-anchor-id="section-9">2012</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/12mype-cahb-tab1.xlsx"</span>  </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>scot_pop12 <span class="ot">&lt;-</span> <span class="fu">get_pop_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 total:  5313600 
 sum of pop categories:  5313600</code></pre>
</div>
</div>
</section>
<section id="section-10" class="level3">
<h3 class="anchored" data-anchor-id="section-10">2011</h3>
<p><strong>Inspect the Data</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># File contains a single sheet</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>scot_pop11 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"./data/scotland-census-2011.xlsx"</span>, </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sheet =</span> <span class="st">"Data Sheet 0"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">skip =</span> <span class="dv">10</span>, <span class="at">n_max =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setDT</span>()</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Second columns is superfluous</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>scot_pop11[, <span class="fu">c</span>(<span class="st">"...2"</span> ) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># remove "All people" column and calculate totals after processing</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>scot_pop11[, <span class="fu">c</span>(<span class="st">"All people"</span>, <span class="st">"Age"</span>) <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># remove second row since it contains NAs</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>scot_pop11 <span class="ot">&lt;-</span> scot_pop11[<span class="dv">2</span>, ]</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>scot_pop11 <span class="sc">|&gt;</span> </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Under 1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">4</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">5</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">6</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">7</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">8</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">9</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">10</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">11</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">12</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">13</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">14</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">15</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">16</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">17</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">18</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">19</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">20</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">21</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">22</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">23</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">24</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">25</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">26</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">27</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">28</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">29</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">30</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">31</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">32</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">33</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">34</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">35</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">36</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">37</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">38</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">39</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">40</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">41</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">42</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">43</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">44</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">45</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">46</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">47</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">48</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">49</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">50</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">51</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">52</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">53</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">54</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">55</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">56</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">57</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">58</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">59</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">60</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">61</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">62</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">63</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">64</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">65</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">66</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">67</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">68</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">69</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">70</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">71</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">72</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">73</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">74</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">75</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">76</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">77</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">78</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">79</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">80</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">81</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">82</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">83</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">84</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">85</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">86</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">87</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">88</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">89</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">90</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">91</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">92</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">93</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">94</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">95</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">96</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">97</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">98</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">99</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">100 and over</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">58715</td>
<td style="text-align: right;">59556</td>
<td style="text-align: right;">58909</td>
<td style="text-align: right;">58764</td>
<td style="text-align: right;">56877</td>
<td style="text-align: right;">55224</td>
<td style="text-align: right;">55236</td>
<td style="text-align: right;">53786</td>
<td style="text-align: right;">52325</td>
<td style="text-align: right;">53046</td>
<td style="text-align: right;">55067</td>
<td style="text-align: right;">56769</td>
<td style="text-align: right;">58656</td>
<td style="text-align: right;">59971</td>
<td style="text-align: right;">61152</td>
<td style="text-align: right;">62278</td>
<td style="text-align: right;">62145</td>
<td style="text-align: right;">64121</td>
<td style="text-align: right;">68130</td>
<td style="text-align: right;">74152</td>
<td style="text-align: right;">74835</td>
<td style="text-align: right;">72001</td>
<td style="text-align: right;">72969</td>
<td style="text-align: right;">73783</td>
<td style="text-align: right;">70352</td>
<td style="text-align: right;">70288</td>
<td style="text-align: right;">69246</td>
<td style="text-align: right;">67813</td>
<td style="text-align: right;">68342</td>
<td style="text-align: right;">69943</td>
<td style="text-align: right;">69202</td>
<td style="text-align: right;">67429</td>
<td style="text-align: right;">64193</td>
<td style="text-align: right;">60491</td>
<td style="text-align: right;">60380</td>
<td style="text-align: right;">63609</td>
<td style="text-align: right;">64355</td>
<td style="text-align: right;">66397</td>
<td style="text-align: right;">70159</td>
<td style="text-align: right;">75536</td>
<td style="text-align: right;">76562</td>
<td style="text-align: right;">76474</td>
<td style="text-align: right;">79587</td>
<td style="text-align: right;">80953</td>
<td style="text-align: right;">81122</td>
<td style="text-align: right;">81314</td>
<td style="text-align: right;">84376</td>
<td style="text-align: right;">82601</td>
<td style="text-align: right;">82554</td>
<td style="text-align: right;">80084</td>
<td style="text-align: right;">78847</td>
<td style="text-align: right;">75598</td>
<td style="text-align: right;">75660</td>
<td style="text-align: right;">73955</td>
<td style="text-align: right;">71767</td>
<td style="text-align: right;">69190</td>
<td style="text-align: right;">67232</td>
<td style="text-align: right;">66128</td>
<td style="text-align: right;">64782</td>
<td style="text-align: right;">63559</td>
<td style="text-align: right;">63996</td>
<td style="text-align: right;">64709</td>
<td style="text-align: right;">66339</td>
<td style="text-align: right;">70598</td>
<td style="text-align: right;">70880</td>
<td style="text-align: right;">53361</td>
<td style="text-align: right;">55060</td>
<td style="text-align: right;">54012</td>
<td style="text-align: right;">51495</td>
<td style="text-align: right;">47270</td>
<td style="text-align: right;">45155</td>
<td style="text-align: right;">46168</td>
<td style="text-align: right;">44637</td>
<td style="text-align: right;">43297</td>
<td style="text-align: right;">41337</td>
<td style="text-align: right;">39583</td>
<td style="text-align: right;">37832</td>
<td style="text-align: right;">35211</td>
<td style="text-align: right;">33146</td>
<td style="text-align: right;">32342</td>
<td style="text-align: right;">30065</td>
<td style="text-align: right;">27162</td>
<td style="text-align: right;">25170</td>
<td style="text-align: right;">21669</td>
<td style="text-align: right;">20459</td>
<td style="text-align: right;">18626</td>
<td style="text-align: right;">15898</td>
<td style="text-align: right;">14181</td>
<td style="text-align: right;">12024</td>
<td style="text-align: right;">10778</td>
<td style="text-align: right;">9439</td>
<td style="text-align: right;">6975</td>
<td style="text-align: right;">4331</td>
<td style="text-align: right;">3321</td>
<td style="text-align: right;">2840</td>
<td style="text-align: right;">2241</td>
<td style="text-align: right;">1825</td>
<td style="text-align: right;">1174</td>
<td style="text-align: right;">857</td>
<td style="text-align: right;">539</td>
<td style="text-align: right;">854</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>This data has two variables:</p>
<ul>
<li><code>age</code> spread across the column names, and</li>
<li>population numbers are stored in the cell values.</li>
</ul>
<p>Need to <code>pivot_longer</code> to create <code>age</code> column and to transpose age values from row to column format.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename "Under 1" column to "0" </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to represent first year of life</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(scot_pop11, <span class="st">"Under 1"</span>, <span class="st">"0"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>scot_pop11 <span class="ot">&lt;-</span> scot_pop11 <span class="sc">%&gt;%</span>    </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(   </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="st">"0"</span><span class="sc">:</span><span class="st">"100 and over"</span>,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"age"</span>,      </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"pop"</span>,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_transform =</span> readr<span class="sc">::</span>parse_number) <span class="sc">|&gt;</span> </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setDT</span>()</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(scot_pop11, <span class="dv">10</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    age   pop
 1:   0 58715
 2:   1 59556
 3:   2 58909
 4:   3 58764
 5:   4 56877
 6:   5 55224
 7:   6 55236
 8:   7 53786
 9:   8 52325
10:   9 53046</code></pre>
</div>
</div>
<p>Aggregate rows for ages 90 and above into a single entry for compatibility with data for 2022 and 2021.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>over90 <span class="ot">&lt;-</span> scot_pop11[<span class="dv">91</span><span class="sc">:</span><span class="dv">101</span>, <span class="fu">sum</span>(pop)]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># remove rows for age 90 and above</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>scot_pop11 <span class="ot">&lt;-</span> scot_pop11[<span class="dv">1</span><span class="sc">:</span><span class="dv">90</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Combine rows into 5-year age categories</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a grouping variable</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>scot_pop11[, age_cat <span class="sc">:</span><span class="er">=</span> <span class="fu">cut2</span>(age, <span class="at">g =</span> <span class="dv">18</span>)]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sum the number of deaths in each age category</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>scot_pop11_cats <span class="ot">&lt;-</span> scot_pop11[, <span class="fu">sum</span>(pop), by <span class="ot">=</span> age_cat]</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>scot_pop11_cats[, pop <span class="sc">:</span><span class="er">=</span> V1][, V1 <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># append an entry for the 90 plus group</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>oldest <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">age_cat =</span> <span class="fu">as.factor</span>(<span class="st">"90 plus"</span>), </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pop =</span> over90)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>scot_pop11 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(scot_pop11_cats, oldest)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># update "age_cat" for compatibility with other years</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>scot_pop11[, age_cat <span class="sc">:</span><span class="er">=</span> age_categories]</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleanup</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(scot_pop11_cats, oldest, over90)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Save cleaned data tables</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>scot_all <span class="ot">&lt;-</span> <span class="fu">ls</span>()[<span class="fu">sapply</span>(<span class="fu">ls</span>(), <span class="cf">function</span>(x) <span class="fu">is.data.frame</span>(<span class="fu">get</span>(x)))]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(<span class="at">list =</span> scot_all, <span class="at">file =</span> <span class="st">"./data-clean/scot-pop.RData"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleanup the environment</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># keep 'age_categories' vector</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> scot_all)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(get_pop_2016, get_pop_year, file_year, scot_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="mortality" class="level2">
<h2 class="anchored" data-anchor-id="mortality">Mortality</h2>
<p>Table 5.02 contains deaths, by sex, age, and administrative area, Scotland</p>
<section id="section-11" class="level3">
<h3 class="anchored" data-anchor-id="section-11">2022</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/vital-events-22-ref-tabs-5.xlsx"</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>scot_mort22 <span class="ot">&lt;-</span> <span class="fu">get_mort_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-12" class="level3">
<h3 class="anchored" data-anchor-id="section-12">2021</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/vital-events-21-ref-tabs-5.xlsx"</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>scot_mort21 <span class="ot">&lt;-</span> <span class="fu">get_mort_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-13" class="level3">
<h3 class="anchored" data-anchor-id="section-13">2020</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/vital-events-20-ref-tabs-5.xlsx"</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>scot_mort20 <span class="ot">&lt;-</span> <span class="fu">get_mort_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-14" class="level3">
<h3 class="anchored" data-anchor-id="section-14">2019</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/vital-events-19-ref-tabs-5.xlsx"</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>scot_mort19 <span class="ot">&lt;-</span> <span class="fu">get_mort_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-15" class="level3">
<h3 class="anchored" data-anchor-id="section-15">2018</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/vital-events-18-ref-tabs-5.xlsx"</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>scot_mort18 <span class="ot">&lt;-</span> <span class="fu">get_mort_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-16" class="level3">
<h3 class="anchored" data-anchor-id="section-16">2017</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/vital-events-17-ref-tabs-5.xlsx"</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>scot_mort17 <span class="ot">&lt;-</span> <span class="fu">get_mort_year</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-17" class="level3">
<h3 class="anchored" data-anchor-id="section-17">2016</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"./code/get-mort-5-2.R"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/vital-events-16-ref-tabs-5-2.xlsx"</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>scot_mort16 <span class="ot">&lt;-</span> <span class="fu">get_mort_5_2</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-18" class="level3">
<h3 class="anchored" data-anchor-id="section-18">2015</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/vital-events-15-ref-tabs-5-2.xlsx"</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>scot_mort15 <span class="ot">&lt;-</span> <span class="fu">get_mort_5_2</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-19" class="level3">
<h3 class="anchored" data-anchor-id="section-19">2014</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/vital-events-14-ref-tabs-5-2.xlsx"</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>scot_mort14 <span class="ot">&lt;-</span> <span class="fu">get_mort_5_2</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-20" class="level3">
<h3 class="anchored" data-anchor-id="section-20">2013</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/vital-events-13-ref-tabs-5-2.xls"</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>scot_mort13 <span class="ot">&lt;-</span> <span class="fu">get_mort_5_2</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-21" class="level3">
<h3 class="anchored" data-anchor-id="section-21">2012</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/vital-events-12-ref-tabs-5-2.xls"</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>scot_mort12 <span class="ot">&lt;-</span> <span class="fu">get_mort_5_2</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="section-22" class="level3">
<h3 class="anchored" data-anchor-id="section-22">2011</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>file_year <span class="ot">&lt;-</span> <span class="st">"./data/vital-events-11-ref-tabs-5-2.xls"</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>scot_mort11 <span class="ot">&lt;-</span> <span class="fu">get_mort_5_2</span>(file_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Save data tables that are in “tidy data” format</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mort_all <span class="ot">&lt;-</span> <span class="fu">ls</span>()[<span class="fu">sapply</span>(<span class="fu">ls</span>(), <span class="cf">function</span>(x) <span class="fu">is.data.frame</span>(<span class="fu">get</span>(x)))]</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(<span class="at">list =</span> mort_all, <span class="at">file =</span> <span class="st">"./data-clean/scot-mort.RData"</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cleanup the environment</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># keep 'age_categories' vector</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> mort_all)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(get_mort_year, get_mort_5_2, file_year, mort_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Welcome</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./data-sources.html" class="pagination-link">
        <span class="nav-page-text">Data Sources</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© CC-By Openscapes, 2022</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This page is built with ❤️ and <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>